patients_mask <- sample(c(T,F), n_patients, replace = T, prob = c(.6, .4))
dim(patients[edges_mask,patients_mask])
edges_mask    <- sample(c(T,F), n_edges, replace = T, prob = c(.7, .3))
patients_mask <- sample(c(T,F), n_patients, replace = T, prob = c(.5, .5))
dim(patients[edges_mask,patients_mask])
edges_mask    <- sample(c(T,F), n_edges, replace = T, prob = c(.7, .3))
patients_mask <- sample(c(T,F), n_patients, replace = T, prob = c(.5, .5))
dim(patients[edges_mask,patients_mask])
edges_mask    <- sample(c(T,F), n_edges, replace = T, prob = c(.7, .3))
patients_mask <- sample(c(T,F), n_patients, replace = T, prob = c(.2, .5))
dim(patients[edges_mask,patients_mask])
edges_mask    <- sample(c(T,F), n_edges, replace = T, prob = c(.7, .3))
patients_mask <- sample(c(T,F), n_patients, replace = T, prob = c(.2, .8))
dim(patients[edges_mask,patients_mask])
edges_mask    <- sample(c(T,F), n_edges, replace = T, prob = c(.7, .3))
patients_mask <- sample(c(T,F), n_patients, replace = T, prob = c(.1, .9))
dim(patients[edges_mask,patients_mask])
edges_mask    <- sample(c(T,F), n_edges, replace = T, prob = c(.7, .3))
patients_mask <- sample(c(T,F), n_patients, replace = T, prob = c(.15, .9))
dim(patients[edges_mask,patients_mask])
edges_mask    <- sample(c(T,F), n_edges, replace = T, prob = c(.7, .3))
patients_mask <- sample(c(T,F), n_patients, replace = T, prob = c(.15, .85))
dim(patients[edges_mask,patients_mask])
edges_mask    <- sample(c(T,F), n_edges, replace = T, prob = c(.7, .3))
patients_mask <- sample(c(T,F), n_patients, replace = T, prob = c(.15, .85))
dim(patients[edges_mask,patients_mask])
patients[edges_mask,patients_mask]
library(arrow)
library(tidyverse)
library(ComplexHeatmap)
library(scales)
setwd("/DeepenData/Repos/geometric_cobra")
df <- read_csv("./results/data/results_for_R.csv") %>% select(-c("...1"))
labels <- read_csv("./results/data/results_for_R_labels.csv") %>% select(-c("...1")) %>% .[[1]]
weights_x_patients <- df%>% select_if(is.numeric)
genes_nodes   <- df%>% select_if(is.character)
n_edges <- nrow(genes_nodes)
n_patients <- length(labels)
library(arrow)
library(tidyverse)
library(ComplexHeatmap)
library(scales)
setwd("/DeepenData/Repos/geometric_cobra")
df <- read_csv("./results/data/results_for_R.csv") %>% select(-c("...1"))
labels <- read_csv("./results/data/results_for_R_labels.csv") %>% select(-c("...1")) %>% .[[1]]
edge_weights_x_patients <- df%>% select_if(is.numeric)
genes_edge   <- df%>% select_if(is.character)
n_edges <- nrow(genes_nodes)
n_patients <- length(labels)
edges_mask    <- sample(c(T,F), n_edges, replace = T, prob = c(.7, .3))
patients_mask <- sample(c(T,F), n_patients, replace = T, prob = c(.15, .85))
edge_weights_x_patients[edges_mask,patients_mask]
edge_weights_x_patients[patients_mask, edges_mask]
edges_mask    <- sample(c(T,F), n_edges, replace = T, prob = c(.7, .3))
patients_mask <- sample(c(T,F), n_patients, replace = T, prob = c(.15, .85))
edge_weights_x_patients_SAMPLE <- edge_weights_x_patients[edges_mask,patients_mask]
labels_SAMPLE <- labels[patients_mask]
library(arrow)
library(tidyverse)
library(ComplexHeatmap)
library(scales)
setwd("/DeepenData/Repos/geometric_cobra")
df <- read_csv("./results/data/results_for_R.csv") %>% select(-c("...1"))
labels <- read_csv("./results/data/results_for_R_labels.csv") %>% select(-c("...1")) %>% .[[1]]
edge_weights_x_patients <- df%>% select_if(is.numeric)
edges_genes   <- df%>% select_if(is.character)
n_edges <- nrow(genes_nodes)
n_patients <- length(labels)
edges_mask    <- sample(c(T,F), n_edges, replace = T, prob = c(.7, .3))
patients_mask <- sample(c(T,F), n_patients, replace = T, prob = c(.15, .85))
edge_weights_x_patients_SAMPLE <- edge_weights_x_patients[edges_mask,patients_mask]
labels_SAMPLE <- labels[patients_mask]
edges_genes_SAMPLE  <- edges_genes[edges_mask]
edges_mask    <- sample(c(T,F), n_edges, replace = T, prob = c(.7, .3))
patients_mask <- sample(c(T,F), n_patients, replace = T, prob = c(.15, .85))
edge_weights_x_patients_SAMPLE <- edge_weights_x_patients[edges_mask,patients_mask]
labels_SAMPLE <- labels[patients_mask]
edges_genes
edges_genes[edges_mask,]
edges_mask    <- sample(c(T,F), n_edges, replace = T, prob = c(.7, .3))
patients_mask <- sample(c(T,F), n_patients, replace = T, prob = c(.15, .85))
edge_weights_x_patients_SAMPLE <- edge_weights_x_patients[edges_mask,patients_mask]
labels_SAMPLE <- labels[patients_mask]
edges_genes_SAMPLE <- edges_genes[edges_mask,]
processed_data <- edge_weights_x_patients_SAMPLE %>% as.matrix() %>% scale %>% rescale
edges_mask    <- sample(c(T,F), n_edges, replace = T, prob = c(.7, .3))
patients_mask <- sample(c(T,F), n_patients, replace = T, prob = c(.15, .85))
edge_weights_x_patients_SAMPLE <- edge_weights_x_patients[edges_mask,patients_mask]
labels_SAMPLE <- labels[patients_mask]
edges_genes_SAMPLE <- edges_genes[edges_mask,]
processed_data <- edge_weights_x_patients_SAMPLE %>% as.matrix() %>% scale %>% rescale
right_annotation = rowAnnotation(Phenotype = labels_SAMPLE)
ht <- Heatmap(processed_data, row_km = 2, column_km = 2,  show_column_names = F, show_row_names = F, right_annotation= right_annotation)
#right_annotation = rowAnnotation(Phenotype = labels_SAMPLE)
ht <- Heatmap(processed_data, row_km = 2, column_km = 2,  show_column_names = F, show_row_names = F)
draw(ht)
#right_annotation = rowAnnotation(Phenotype = labels_SAMPLE)
ht <- Heatmap(processed_data, row_km = 2, column_km = 2,  show_column_names = F, show_row_names = F)
draw(ht)
#right_annotation = rowAnnotation(Phenotype = labels_SAMPLE)
ht <- Heatmap(processed_data, row_km = 2, column_km = 2,  show_column_names = F, show_row_names = F)
draw(ht)
#right_annotation = rowAnnotation(Phenotype = labels_SAMPLE)
ht <- Heatmap(t(processed_data), row_km = 2, column_km = 2,  show_column_names = F, show_row_names = F)
draw(ht)
right_annotation = rowAnnotation(Phenotype = labels_SAMPLE)
ht <- Heatmap(t(processed_data), row_km = 2, column_km = 2,  show_column_names = F, show_row_names = F)
draw(ht)
right_annotation = rowAnnotation(Phenotype = labels_SAMPLE)
ht <- Heatmap(t(processed_data), row_km = 2, column_km = 2,  show_column_names = F, show_row_names = F)
draw(ht)
right_annotation = rowAnnotation(Phenotype = labels_SAMPLE)
ht <- Heatmap(t(processed_data), row_km = 2, column_km = 2,  show_column_names = F, show_row_names = F, right_annotation= right_annotation)
draw(ht)
heatmap_clusters <- waRRior::heatmap_extract_cluster(draw(ht), processed_data,  which = "row")
edges_clusters   <-  heatmap_clusters[['Cluster']]
unique(edges_clusters)
right_annotation = rowAnnotation(Phenotype = labels_SAMPLE)
ht <- Heatmap(t(processed_data), row_km = 2, column_km = 2,  show_column_names = F, show_row_names = F, right_annotation= right_annotation)
heatmap_clusters <- waRRior::heatmap_extract_cluster(draw(ht), processed_data,  which = "row")
right_annotation = rowAnnotation(Phenotype = labels_SAMPLE)
ht <- Heatmap(t(processed_data), row_km = 2, column_km = 2,  show_column_names = F, show_row_names = F, right_annotation= right_annotation)
heatmap_clusters <- waRRior::heatmap_extract_cluster(draw(ht), processed_data,  which = "row")
edges_clusters   <-  heatmap_clusters[['Cluster']]
unique(edges_clusters)
edges_genes %>% mutate(genes = genes %>% str_extract_all('\\d+(?=\\.)')) %>% .[['genes']]
genes_list <- edges_genes %>% mutate(genes = genes %>% str_extract_all('\\d+(?=\\.)')) %>% .[['genes']]
entrez_IDs <- genes_list%>% unlist() %>% unique()
genes_list <- edges_genes %>% mutate(genes = genes %>% str_extract_all('\\d+(?=\\.)')) %>% .[['genes']]
entrez_IDs <- genes_list%>% unlist() %>% unique()
entrez_IDs
genes_list
edges_genes
genes_list <- edges_genes %>% mutate(genes = genes %>% str_extract_all('\\d+(?=\\.)')) %>% .[['genes']]
entrez_IDs <- genes_list%>% unlist() %>% unique()
clusters <- unique(edges_clusters)
edges_clusters   <-  heatmap_clusters[['Cluster']]
clusters <- unique(edges_clusters)
heatmap_clusters
right_annotation = rowAnnotation(Phenotype = labels_SAMPLE)
ht <- Heatmap(t(processed_data), row_km = 2, column_km = 3,  show_column_names = F, show_row_names = F, right_annotation= right_annotation)
heatmap_clusters <- waRRior::heatmap_extract_cluster(draw(ht), processed_data,  which = "row")
heatmap_clusters
right_annotation = rowAnnotation(Phenotype = labels_SAMPLE)
ht <- Heatmap(t(processed_data), row_km = 2, column_km = 3,  show_column_names = F, show_row_names = F, right_annotation= right_annotation)
heatmap_clusters <- waRRior::heatmap_extract_cluster(draw(ht), processed_data,  which = "row")
heatmap_clusters
right_annotation = rowAnnotation(Phenotype = labels_SAMPLE)
ht <- Heatmap(t(processed_data), row_km = 2, column_km = 3,  show_column_names = F, show_row_names = F, right_annotation= right_annotation)
heatmap_clusters <- waRRior::heatmap_extract_cluster(draw(ht), t(processed_data),  which = "column")
right_annotation = rowAnnotation(Phenotype = labels_SAMPLE)
ht <- Heatmap(t(processed_data), row_km = 2, column_km = 3,  show_column_names = F, show_row_names = F, right_annotation= right_annotation)
heatmap_clusters <- waRRior::heatmap_extract_cluster(draw(ht), t(processed_data),  which = "column")
heatmap_clusters
genes_list <- edges_genes_SAMPLE %>% mutate(genes = genes %>% str_extract_all('\\d+(?=\\.)')) %>% .[['genes']]
edges_genes_SAMPLE
edges_clusters
right_annotation = rowAnnotation(Phenotype = labels_SAMPLE)
ht <- Heatmap(t(processed_data), row_km = 2, column_km = 3,  show_column_names = F, show_row_names = F, right_annotation= right_annotation)
heatmap_clusters <- waRRior::heatmap_extract_cluster(draw(ht), t(processed_data),  which = "column")
edges_clusters   <-  heatmap_clusters[['Cluster']]
edges_clusters
edges_clusters == "1"
edges_clusters   <-  heatmap_clusters[['Cluster']]
cluster_mask <- edges_clusters == "1"
edges_clusters   <-  heatmap_clusters[['Cluster']]
cluster_mask <- edges_clusters == "1"
edges_genes_SAMPLE[cluster_mask]
edges_genes_SAMPLE
edges_genes_SAMPLE$genes[cluster_mask]
edges_clusters   <-  heatmap_clusters[['Cluster']]
cluster_mask <- edges_clusters == "1"
genes_list <- edges_genes_SAMPLE$genes[cluster_mask] %>% mutate(genes = genes %>% str_extract_all('\\d+(?=\\.)')) %>% .[['genes']]
edges_clusters   <-  heatmap_clusters[['Cluster']]
cluster_mask <- edges_clusters == "1"
genes_list <- edges_genes_SAMPLE$genes[cluster_mask] %>% str_extract_all('\\d+(?=\\.)')
entrez_IDs <- genes_list%>% unlist() %>% unique()
entrez_IDs
cluster_mask     <- edges_clusters == "1"
edges_clusters   <-  heatmap_clusters[['Cluster']]
genes_list       <- edges_genes_SAMPLE$genes[cluster_mask] %>% str_extract_all('\\d+(?=\\.)')
entrez_IDs       <- genes_list%>% unlist() %>% unique()
entrez_IDs
cluster_mask     <- edges_clusters == "2"
edges_clusters   <-  heatmap_clusters[['Cluster']]
genes_list       <- edges_genes_SAMPLE$genes[cluster_mask] %>% str_extract_all('\\d+(?=\\.)')
entrez_IDs       <- genes_list%>% unlist() %>% unique()
entrez_IDs
cluster_mask     <- edges_clusters == "3"
edges_clusters   <-  heatmap_clusters[['Cluster']]
genes_list       <- edges_genes_SAMPLE$genes[cluster_mask] %>% str_extract_all('\\d+(?=\\.)')
entrez_IDs       <- genes_list%>% unlist() %>% unique()
entrez_IDs
get_entrez_IDs_cluster <- function(a_cluster) {
cluster_mask     <- edges_clusters ==a_cluster
edges_clusters   <-  heatmap_clusters[['Cluster']]
genes_list       <- edges_genes_SAMPLE$genes[cluster_mask] %>% str_extract_all('\\d+(?=\\.)')
entrez_IDs       <- genes_list%>% unlist() %>% unique()
entrez_IDs
}
get_entrez_IDs_cluster("1")
get_entrez_IDs_cluster("2")
get_entrez_IDs_cluster <- function(a_cluster) {
cluster_mask     <- edges_clusters ==a_cluster
edges_clusters   <-  heatmap_clusters[['Cluster']]
genes_list       <- edges_genes_SAMPLE$genes[cluster_mask] %>% str_extract_all('\\d+(?=\\.)')
entrez_IDs       <- genes_list%>% unlist() %>% unique()
return(entrez_IDs)}
get_entrez_IDs_cluster("2")
get_entrez_IDs_cluster <- function(a_cluster) {
cluster_mask     <- edges_clusters ==a_cluster
edges_clusters   <-  heatmap_clusters[['Cluster']]
genes_list       <- edges_genes_SAMPLE$genes[cluster_mask] %>% str_extract_all('\\d+(?=\\.)')
entrez_IDs       <- genes_list%>% unlist() %>% unique()
return(entrez_IDs)}
sapply(c("1","2","3"), get_entrez_IDs_cluster)
get_entrez_IDs_cluster <- function(a_cluster) {
cluster_mask     <- edges_clusters ==a_cluster
edges_clusters   <-  heatmap_clusters[['Cluster']]
genes_list       <- edges_genes_SAMPLE$genes[cluster_mask] %>% str_extract_all('\\d+(?=\\.)')
entrez_IDs       <- genes_list%>% unlist() %>% unique()
return(entrez_IDs)}
lapply(c("1","2","3"), get_entrez_IDs_cluster)
get_entrez_IDs_cluster <- function(a_cluster) {
cluster_mask     <- edges_clusters ==a_cluster
edges_clusters   <-  heatmap_clusters[['Cluster']]
genes_list       <- edges_genes_SAMPLE$genes[cluster_mask] %>% str_extract_all('\\d+(?=\\.)')
entrez_IDs       <- genes_list%>% unlist() %>% unique()
return(entrez_IDs)}
clusters <- unique(edges_clusters)
lapply(clusters, get_entrez_IDs_cluster)
get_entrez_IDs_cluster <- function(a_cluster) {
cluster_mask     <- edges_clusters ==a_cluster
edges_clusters   <-  heatmap_clusters[['Cluster']]
genes_list       <- edges_genes_SAMPLE$genes[cluster_mask] %>% str_extract_all('\\d+(?=\\.)')
entrez_IDs       <- genes_list%>% unlist() %>% unique()
return(entrez_IDs)}
clusters <- unique(edges_clusters)
lapply(clusters, get_entrez_IDs_cluster)
library(arrow)
library(tidyverse)
library(ComplexHeatmap)
library(scales)
setwd("/DeepenData/Repos/geometric_cobra")
df <- read_csv("./results/data/results_for_R.csv") %>% select(-c("...1"))
labels <- read_csv("./results/data/results_for_R_labels.csv") %>% select(-c("...1")) %>% .[[1]]
edge_weights_x_patients <- df%>% select_if(is.numeric)
edges_genes   <- df%>% select_if(is.character)
n_edges <- nrow(genes_nodes)
n_patients <- length(labels)
edges_mask    <- sample(c(T,F), n_edges, replace = T, prob = c(.7, .3))
patients_mask <- sample(c(T,F), n_patients, replace = T, prob = c(.15, .85))
edge_weights_x_patients_SAMPLE <- edge_weights_x_patients[edges_mask,patients_mask]
labels_SAMPLE <- labels[patients_mask]
edges_genes_SAMPLE <- edges_genes[edges_mask,]
processed_data <- edge_weights_x_patients_SAMPLE %>% as.matrix() %>% scale %>% rescale
right_annotation = rowAnnotation(Phenotype = labels_SAMPLE)
ht <- Heatmap(t(processed_data), row_km = 2, column_km = 3,  show_column_names = F, show_row_names = F, right_annotation= right_annotation)
heatmap_clusters <- waRRior::heatmap_extract_cluster(draw(ht), t(processed_data),  which = "column")
heatmap_clusters
get_entrez_IDs_cluster <- function(a_cluster) {
cluster_mask     <- edges_clusters ==a_cluster
edges_clusters   <-  heatmap_clusters[['Cluster']]
genes_list       <- edges_genes_SAMPLE$genes[cluster_mask] %>% str_extract_all('\\d+(?=\\.)')
entrez_IDs       <- genes_list%>% unlist() %>% unique()
return(entrez_IDs)}
clusters <- unique(edges_clusters)
lapply(clusters, get_entrez_IDs_cluster)
library(arrow)
library(tidyverse)
library(ComplexHeatmap)
library(scales)
setwd("/DeepenData/Repos/geometric_cobra")
df <- read_csv("./results/data/results_for_R.csv") %>% select(-c("...1"))
labels <- read_csv("./results/data/results_for_R_labels.csv") %>% select(-c("...1")) %>% .[[1]]
edge_weights_x_patients <- df%>% select_if(is.numeric)
edges_genes   <- df%>% select_if(is.character)
n_edges <- nrow(genes_nodes)
library(arrow)
library(tidyverse)
library(ComplexHeatmap)
library(scales)
setwd("/DeepenData/Repos/geometric_cobra")
df <- read_csv("./results/data/results_for_R.csv") %>% select(-c("...1"))
labels <- read_csv("./results/data/results_for_R_labels.csv") %>% select(-c("...1")) %>% .[[1]]
edge_weights_x_patients <- df%>% select_if(is.numeric)
edges_genes   <- df%>% select_if(is.character)
n_edges <- nrow(edges_genes)
n_patients <- length(labels)
edges_mask    <- sample(c(T,F), n_edges, replace = T, prob = c(.7, .3))
patients_mask <- sample(c(T,F), n_patients, replace = T, prob = c(.15, .85))
edge_weights_x_patients_SAMPLE <- edge_weights_x_patients[edges_mask,patients_mask]
labels_SAMPLE <- labels[patients_mask]
edges_genes_SAMPLE <- edges_genes[edges_mask,]
processed_data <- edge_weights_x_patients_SAMPLE %>% as.matrix() %>% scale %>% rescale
right_annotation = rowAnnotation(Phenotype = labels_SAMPLE)
ht <- Heatmap(t(processed_data), row_km = 2, column_km = 3,  show_column_names = F, show_row_names = F, right_annotation= right_annotation)
heatmap_clusters <- waRRior::heatmap_extract_cluster(draw(ht), t(processed_data),  which = "column")
heatmap_clusters
get_entrez_IDs_cluster <- function(a_cluster) {
cluster_mask     <- edges_clusters ==a_cluster
edges_clusters   <-  heatmap_clusters[['Cluster']]
genes_list       <- edges_genes_SAMPLE$genes[cluster_mask] %>% str_extract_all('\\d+(?=\\.)')
entrez_IDs       <- genes_list%>% unlist() %>% unique()
return(entrez_IDs)}
clusters <- unique(edges_clusters)
get_entrez_IDs_cluster <- function(a_cluster) {
edges_clusters   <-  heatmap_clusters[['Cluster']]
cluster_mask     <- edges_clusters ==a_cluster
genes_list       <- edges_genes_SAMPLE$genes[cluster_mask] %>% str_extract_all('\\d+(?=\\.)')
entrez_IDs       <- genes_list%>% unlist() %>% unique()
return(entrez_IDs)}
clusters <- unique(edges_clusters)
get_entrez_IDs_cluster <- function(a_cluster) {
edges_clusters   <-  heatmap_clusters[['Cluster']]
cluster_mask     <- edges_clusters ==a_cluster
genes_list       <- edges_genes_SAMPLE$genes[cluster_mask] %>% str_extract_all('\\d+(?=\\.)')
entrez_IDs       <- genes_list%>% unlist() %>% unique()
return(entrez_IDs)}
clusters <- unique(heatmap_clusters[['Cluster']])
lapply(clusters, get_entrez_IDs_cluster)
library(arrow)
library(tidyverse)
library(ComplexHeatmap)
library(scales)
setwd("/DeepenData/Repos/geometric_cobra")
df <- read_csv("./results/data/results_for_R.csv") %>% select(-c("...1"))
labels <- read_csv("./results/data/results_for_R_labels.csv") %>% select(-c("...1")) %>% .[[1]]
edge_weights_x_patients <- df%>% select_if(is.numeric)
edges_genes   <- df%>% select_if(is.character)
n_edges <- nrow(edges_genes)
n_patients <- length(labels)
edges_mask    <- sample(c(T,F), n_edges, replace = T, prob = c(.7, .3))
patients_mask <- sample(c(T,F), n_patients, replace = T, prob = c(.15, .85))
edge_weights_x_patients_SAMPLE <- edge_weights_x_patients[edges_mask,patients_mask]
labels_SAMPLE <- labels[patients_mask]
edges_genes_SAMPLE <- edges_genes[edges_mask,]
processed_data <- edge_weights_x_patients_SAMPLE %>% as.matrix() %>% scale %>% rescale
right_annotation = rowAnnotation(Phenotype = labels_SAMPLE)
ht <- Heatmap(t(processed_data), row_km = 2, column_km = 3,  show_column_names = F, show_row_names = F, right_annotation= right_annotation)
heatmap_clusters <- waRRior::heatmap_extract_cluster(draw(ht), t(processed_data),  which = "column")
heatmap_clusters
get_entrez_IDs_cluster <- function(a_cluster) {
edges_clusters   <-  heatmap_clusters[['Cluster']]
cluster_mask     <- edges_clusters ==a_cluster
genes_list       <- edges_genes_SAMPLE$genes[cluster_mask] %>% str_extract_all('\\d+(?=\\.)')
entrez_IDs       <- genes_list%>% unlist() %>% unique()
return(entrez_IDs)}
clusters <- unique(heatmap_clusters[['Cluster']])
lapply(clusters, get_entrez_IDs_cluster)
library(arrow)
library(tidyverse)
library(ComplexHeatmap)
library(scales)
setwd("/DeepenData/Repos/geometric_cobra")
filtered_graph_weights <- read_parquet("./results/data/filtered_graph_weights.parquet.gzip")
data_sample <- function(data, n_rows, n_cols){
return(
sample_n(data, n_rows)[, c(
sample(1:ncol(data) , n_cols), which(names(data) == "Label")
)]
)
}
data_subset <- filtered_graph_weights %>% data_sample(500,600)
labels      <- data_subset$Label
data        <- data_subset %>% select(-c("Label"))%>% tidyr::as_tibble()
right_annotation = rowAnnotation(Phenotype = labels)
data
ht <- Heatmap(data %>% as.matrix() %>% scale %>% rescale, row_km = 2, column_km = 2, right_annotation = right_annotation, show_column_names = F, show_row_names = F)
library(arrow)
library(tidyverse)
library(ComplexHeatmap)
library(scales)
setwd("/DeepenData/Repos/geometric_cobra")
df <- read_csv("./results/data/results_for_R.csv") %>% select(-c("...1"))
labels <- read_csv("./results/data/results_for_R_labels.csv") %>% select(-c("...1")) %>% .[[1]]
edge_weights_x_patients <- df%>% select_if(is.numeric)
edges_genes   <- df%>% select_if(is.character)
n_edges <- nrow(edges_genes)
n_patients <- length(labels)
edges_mask    <- sample(c(T,F), n_edges, replace = T, prob = c(.7, .3))
patients_mask <- sample(c(T,F), n_patients, replace = T, prob = c(.15, .85))
edge_weights_x_patients_SAMPLE <- edge_weights_x_patients[edges_mask,patients_mask]
labels_SAMPLE <- labels[patients_mask]
edges_genes_SAMPLE <- edges_genes[edges_mask,]
processed_data <- edge_weights_x_patients_SAMPLE %>% as.matrix() %>% scale %>% rescale
right_annotation = rowAnnotation(Phenotype = labels_SAMPLE)
ht <- Heatmap(t(processed_data), row_km = 2, column_km = 3,  show_column_names = F, show_row_names = F, right_annotation= right_annotation)
heatmap_clusters <- waRRior::heatmap_extract_cluster(draw(ht), t(processed_data),  which = "column")
get_entrez_IDs_cluster <- function(a_cluster) {
edges_clusters   <-  heatmap_clusters[['Cluster']]
cluster_mask     <- edges_clusters ==a_cluster
genes_list       <- edges_genes_SAMPLE$genes[cluster_mask] %>% str_extract_all('\\d+(?=\\.)')
entrez_IDs       <- genes_list%>% unlist() %>% unique()
return(entrez_IDs)}
clusters <- unique(heatmap_clusters[['Cluster']])
lapply(clusters, get_entrez_IDs_cluster)
library(arrow)
library(tidyverse)
library(ComplexHeatmap)
library(scales)
library(ggpubr)
library(ggplot2)
library(DOSE)
library(magrittr)
library(biomaRt)
library(tidyverse)
library(clusterProfiler)
library(ReactomePA)
library(org.Hs.eg.db)
setwd("/DeepenData/Repos/geometric_cobra")
df <- read_csv("./results/data/Non_masked_results_for_R.csv") %>% dplyr::select(-c("...1"))
labels <- read_csv("./results/data/results_for_R_labels.csv") %>%  dplyr::select(-c("...1")) %>% .[[1]]
edge_weights_x_patients <- df%>%  dplyr::select_if(is.numeric)
edges_genes   <- df%>%  dplyr::select_if(is.character)
n_edges <- nrow(edges_genes)
n_patients <- length(labels)
edges_mask    <- sample(c(T,F), n_edges, replace = T, prob = c(1, 0))
edges_mask    <- sample(c(T,F), n_edges, replace = T, prob = c(1, 0))
patients_mask <- sample(c(T,F), n_patients, replace = T, prob = c(.2, .8))
edge_weights_x_patients_SAMPLE <- edge_weights_x_patients[edges_mask,patients_mask]
labels_SAMPLE <- labels[patients_mask]
edges_genes_SAMPLE <- edges_genes[edges_mask,]
processed_data <- edge_weights_x_patients_SAMPLE %>% as.matrix() %>% scale %>% rescale
edges_mask    <- sample(c(T,F), n_edges, replace = T, prob = c(1, 0))
patients_mask <- sample(c(T,F), n_patients, replace = T, prob = c(.2, .8))
edge_weights_x_patients_SAMPLE <- edge_weights_x_patients[edges_mask,patients_mask]
labels_SAMPLE <- labels[patients_mask]
edges_genes_SAMPLE <- edges_genes[edges_mask,]
processed_data <- edge_weights_x_patients_SAMPLE %>% as.matrix() %>% scale %>% rescale
dim(processed_data)
right_annotation = rowAnnotation(Phenotype = labels_SAMPLE)
ht <- Heatmap(t(processed_data), row_km = 2, column_km = 4,  show_column_names = F, show_row_names = F, right_annotation= right_annotation)
heatmap_clusters <- waRRior::heatmap_extract_cluster(draw(ht), t(processed_data),  which = "column")
get_entrez_IDs_cluster <- function(a_cluster) {
edges_clusters   <-  heatmap_clusters[['Cluster']]
cluster_mask     <- edges_clusters ==a_cluster
genes_list       <- edges_genes_SAMPLE$genes[cluster_mask] %>% str_extract_all('\\d+(?=\\.)')
entrez_IDs       <- genes_list%>% unlist() %>% unique()
return(entrez_IDs)}
clusters <- unique(heatmap_clusters[['Cluster']])
lapply(clusters, get_entrez_IDs_cluster) %>% purrr::set_names(clusters) -> clusters_list
clusters_list[c("4","3","2")] %>% compareCluster(fun='enrichPathway', pvalueCutoff=1e-4)-> enrich_output
enrich_output %>% dotplot(showCategory = 7, font.size = 7, label_format =35)
clusters_list[c("4","3","2")] %>% compareCluster(fun='enrichPathway', pvalueCutoff=1e-5)-> enrich_output
enrich_output %>% dotplot(showCategory = 7, font.size = 7, label_format =35)
clusters_list[c("2","3")] %>% compareCluster(fun='enrichKEGG', pvalueCutoff=5e-2)-> enrich_output
enrich_output %>% dotplot(showCategory = 7, font.size = 7, label_format =35)
clusters_list[c("4","3","2")] %>% compareCluster(fun='enrichKEGG', pvalueCutoff=5e-2)-> enrich_output
enrich_output %>% dotplot(showCategory = 7, font.size = 7, label_format =35)
clusters_list[c("4","3","2")] %>% compareCluster(fun='enrichDGN', pvalueCutoff=5e-2)-> enrich_output
enrich_output %>% dotplot(showCategory = 7, font.size = 7, label_format =35)
clusters_list[c("4","3","2")] %>% compareCluster(fun='enrichDGN', pvalueCutoff=5e-3)-> enrich_output
enrich_output %>% dotplot(showCategory = 7, font.size = 7, label_format =35)
clusters_list[c("4","3","2")] %>% compareCluster(fun='enrichDGN', pvalueCutoff=1e-5)-> enrich_output
enrich_output %>% dotplot(showCategory = 7, font.size = 7, label_format =35)
clusters_list[c("4","3","2")] %>% compareCluster(fun='enrichDGN', pvalueCutoff=5e-5)-> enrich_output
enrich_output %>% dotplot(showCategory = 7, font.size = 7, label_format =35)
clusters_list[c("4","3","2")] %>% compareCluster(fun='enrichDGN', pvalueCutoff=5e-4)-> enrich_output
enrich_output %>% dotplot(showCategory = 7, font.size = 7, label_format =35)
clusters_list[c("4","3","2")] %>% compareCluster(fun='enrichDGN', pvalueCutoff=1e-3)-> enrich_output
enrich_output %>% dotplot(showCategory = 7, font.size = 7, label_format =35)
clusters_list[c("4","3","2")] %>% compareCluster(fun='enrichDGN', pvalueCutoff=1e-2)-> enrich_output
enrich_output %>% dotplot(showCategory = 7, font.size = 7, label_format =35)
enrich_output %>% dotplot(showCategory = 5, font.size = 7, label_format =35)
enrich_output %>% dotplot(showCategory = 6, font.size = 7, label_format =35)
library(arrow)
library(tidyverse)
library(ComplexHeatmap)
library(scales)
library(ggpubr)
library(ggplot2)
library(DOSE)
library(magrittr)
library(biomaRt)
library(tidyverse)
library(clusterProfiler)
library(ReactomePA)
library(org.Hs.eg.db)
setwd("/DeepenData/Repos/geometric_cobra")
df <- read_csv("./results/data/Masked_results_for_R.csv") %>% dplyr::select(-c("...1"))
labels <- read_csv("./results/data/results_for_R_labels.csv") %>%  dplyr::select(-c("...1")) %>% .[[1]]
edge_weights_x_patients <- df%>%  dplyr::select_if(is.numeric)
edges_genes   <- df%>%  dplyr::select_if(is.character)
n_edges <- nrow(edges_genes)
n_patients <- length(labels)
#view(edges_genes)
edges_mask    <- sample(c(T,F), n_edges, replace = T, prob = c(1, 0))
patients_mask <- sample(c(T,F), n_patients, replace = T, prob = c(.3, .7))
edge_weights_x_patients_SAMPLE <- edge_weights_x_patients[edges_mask,patients_mask]
labels_SAMPLE <- labels[patients_mask]
edges_genes_SAMPLE <- edges_genes[edges_mask,]
processed_data <- edge_weights_x_patients_SAMPLE %>% as.matrix() %>% scale %>% rescale
dim(processed_data)
right_annotation = rowAnnotation(Phenotype = labels_SAMPLE)
ht <- Heatmap(t(processed_data), row_km = 2, column_km = 4,  show_column_names = F, show_row_names = F, right_annotation= right_annotation)
heatmap_clusters <- waRRior::heatmap_extract_cluster(draw(ht), t(processed_data),  which = "column")
get_entrez_IDs_cluster <- function(a_cluster) {
edges_clusters   <-  heatmap_clusters[['Cluster']]
cluster_mask     <- edges_clusters ==a_cluster
genes_list       <- edges_genes_SAMPLE$genes[cluster_mask] %>% str_extract_all('\\d+(?=\\.)')
entrez_IDs       <- genes_list%>% unlist() %>% unique()
return(entrez_IDs)}
clusters <- unique(heatmap_clusters[['Cluster']])
lapply(clusters, get_entrez_IDs_cluster) %>% purrr::set_names(clusters) -> clusters_list
clusters_list[c("4","3","2")] %>% compareCluster(fun='enrichPathway', pvalueCutoff=1e-2)-> enrich_output
enrich_output %>% dotplot(showCategory = 5, font.size = 7, label_format =35)
clusters_list[c("4","3","2")] %>% compareCluster(fun='enrichKEGG', pvalueCutoff=1e-2)-> enrich_output
enrich_output %>% dotplot(showCategory = 7, font.size = 7, label_format =35)
clusters_list[c("4","3","2")] %>% compareCluster(fun='enrichDGN', pvalueCutoff=1e-2)-> enrich_output
enrich_output %>% dotplot(showCategory = 6, font.size = 7, label_format =35)
setwd("/DeepenData/Repos/geometric_cobra")
